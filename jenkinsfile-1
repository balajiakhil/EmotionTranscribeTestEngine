pipeline {
    agent {
        label 'any'
    }

    options {
        buildDiscarder(logRotator(numToKeepStr: '5'))
    }

    environment {
        SONAR_SCANNER_HOME = tool 'sonarscanner'
        SONAR_PROJECT_KEY = 'EmotionTranscribeSonar'
        SONAR_HOST_URL = 'http://localhost:9000'
    }

    stages {
        stage('SonarQube Analysis') {
            steps {
                script {
                    withSonarQubeEnv() {
                        sh "ls ${SONAR_SCANNER_HOME}"
                        sh "echo ${SONAR_SCANNER_HOME}"
                        sh "${env.SONAR_SCANNER_HOME}/bin/sonar-scanner \
                        -Dsonar.projectKey=${env.SONAR_PROJECT_KEY} \
                        -Dsonar.sources=. \
                        -Dsonar.host.url=${env.SONAR_HOST_URL} \
                        -Dsonar.token=sqp_d93bb8eb87ec34e57b8dc514b57141a6c8eb5d01"
                    }
                }
            }
        }
    }
}
